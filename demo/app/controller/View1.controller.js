sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast"],(e,t,n)=>{"use strict";return e.extend("demo.demo.controller.View1",{onInit(){const e={MaterialNumber:"61034399",MaterialDescription:"SUAVIzante CMPL 46F CS SP MORNING SUN",PackingInfo:"75 CS = 1 PAL",Catalogs:{ProductionLines:[{key:"HCLinea_A",text:"HC Línea A"},{key:"HCLinea_B",text:"HC Línea B"},{key:"HCLinea_C",text:"HC Línea C"}],Printers:[{key:"PRN_A1",text:"Printer A1"},{key:"PRN_A2",text:"Printer A2"},{key:"PRN_B1",text:"Printer B1"}],BatchList:[{key:"5316MX111A",text:"5316MX111A"},{key:"5316MX222A",text:"5316MX222A"},{key:"5316MX333A",text:"5316MX333A"}]},Filters:{ProductionLine:"HCLinea_A",LinePrinter:"HCLinea_A",PrinterEnabled:true,OrderNumber:"108785909",BatchList:"5316MX111A"},HUCount:26,TotalCases:1950,HUs:[{HU:"175095467401692471",HuCreatedMill:true,HuCreatedSap:true,GrInSap:false,Batch:"5316MX111A",Shift:"2",MaterialNumber:"61034399",Amount:75,CreatedOn:"Nov 12 2025 04:29:38 PM"},{HU:"175095467401692488",HuCreatedMill:true,HuCreatedSap:true,GrInSap:true,Batch:"5316MX111A",Shift:"2",MaterialNumber:"61034399",Amount:75,CreatedOn:"Nov 12 2025 04:45:25 PM"},{HU:"175095467401692495",HuCreatedMill:true,HuCreatedSap:true,GrInSap:false,Batch:"5316MX111A",Shift:"2",MaterialNumber:"61034399",Amount:75,CreatedOn:"Nov 12 2025 04:16:06 PM"}],BackupPrinter:"HCLinea_A",PartialPallet:true,QtyPerPallet:75,Comment:""};const n=new t(e);this.getView().setModel(n);this.loadPrinters();this.loadWorkCenters();this.onGetHu()},onRefresh:function(){this.onGetHu()},statusColorFormatter:function(e){if(e===""||e===null||e===undefined)return"#e9730c";const t=e==="1"||e===1||e===true;return t?"#107e3e":"#bb0000"},loadPrinters:async function(){try{const e=await fetch("/api/selectprinter",{method:"POST",headers:{"Content-Type":"application/xml",Accept:"application/xml"},body:"<ROOT/>"});if(!e.ok)throw new Error(await e.text());const t=await e.text();console.log("xmlText",t);const n=new DOMParser;const r=n.parseFromString(t,"text/xml");console.log("xmlres",r);const o=Array.from(r.getElementsByTagName("row"));const a=o.map(e=>({key:e.getElementsByTagName("PRINTER")[0]?.textContent?.trim()||"",text:e.getElementsByTagName("DESCRIPCION")[0]?.textContent?.trim()||""}));console.log("aRows:",a);const s=this.getView().getModel();s.setProperty("/Catalogs/Printers",a)}catch(e){console.error("loadPrinters error:",e)}},loadWorkCenters:async function(){try{const e=await fetch("/api/selectpuesto_trabajo",{method:"POST",headers:{"Content-Type":"application/xml",Accept:"application/xml"},body:"<ROOT/>"});if(!e.ok)throw new Error(await e.text());const t=await e.text();const n=new DOMParser;const r=n.parseFromString(t,"text/xml");console.log("xmlres",r);const o=Array.from(r.getElementsByTagName("row"));const a=o.map(e=>({key:e.getElementsByTagName("PUESTO_TRABAJO")[0]?.textContent?.trim()||"",text:e.getElementsByTagName("DESC")[0]?.textContent?.trim()||""}));console.log("aRows:",a);const s=this.getView().getModel();s.setProperty("/Catalogs/ProductionLines",a)}catch(e){console.error("loadWorkCenters error:",e)}},onGetHu:async function(){const e=this.getView();const t=e.getModel();var n=this.getView().byId("_IDGenInput1");var r=n.getValue();if(!r){console.log("Falta valor de orden");return}const o=`<ROOT>\n                <select>\n                    <ORDEN>${this._escapeXml(r)}</ORDEN>\n                </select>\n                </ROOT>`;try{const e=await fetch("/api/selecthu",{method:"POST",headers:{"Content-Type":"application/xml; charset=utf-8",Accept:"application/xml"},body:o});if(!e.ok){const t=await e.text();console.error("Error body:",t);throw new Error(`HTTP ${e.status}: ${t}`)}console.log("res: ",e);const n=await e.text();const r=this._parseSelectHuResponse(n);t.setProperty("/HUs",r);t.setProperty("/HUCount",r.length);const a=r.reduce((e,t)=>e+(parseInt(t.Amount,10)||0),0);t.setProperty("/TotalCases",a)}catch(e){console.error("loadGetHu error:",e)}},_parseSelectHuResponse:function(e){const t=(new DOMParser).parseFromString(e,"application/xml");const n=t.getElementsByTagName("parsererror")[0];if(n){throw new Error("Respuesta XML inválida")}const r=Array.from(t.getElementsByTagName("row"));return r.map(e=>({HU:this._getText(e,"HU"),HuCreatedMill:this._getText(e,"HUMII"),HuCreatedSap:this._getText(e,"HUSAP"),GrInSap:this._getText(e,"GRSAP"),Batch:this._getText(e,"BATCH"),Shift:this._getText(e,"SHITF"),MaterialNumber:this._getText(e,"MATERIAL"),Amount:this._getText(e,"AMOUNT"),CreatedOn:this._getText(e,"DATE"),OrderNumber:this._getText(e,"ORDEN"),ProductionLine:this._getText(e,"PUESTO_TRABAJO")}))},_getText:function(e,t){const n=e.getElementsByTagName(t)[0];return n?(n.textContent||"").trim():""},_escapeXml:function(e){return String(e).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&apos;")},_generateHu18:function(){let e="";for(let t=0;t<18;t++){e+=Math.floor(Math.random()*10)}if(e[0]==="0")e="1"+e.slice(1);return e},onCloseInsertHuDialog:function(){this.byId("dlgInsertHu").close()},onOpenInsertHuDialog:function(){const e=this._generateHu18();this.byId("inHu").setValue(e);this.byId("dlgInsertHu").open()},_v:function(e){return this.byId(e).getValue()},onSubmitInsertHu:async function(){try{const e=`\n            <ROOT>\n            <select>\n                <HU>${this._escapeXml(this._v("inHu"))}</HU>\n                <HUMII>${this._escapeXml(this._v("inHumii"))}</HUMII>\n                <HUSAP>${this._escapeXml(this._v("inHusap"))}</HUSAP>\n                <GRSAP>${this._escapeXml(this._v("inGrsap"))}</GRSAP>\n                <BATCH>${this._escapeXml(this._v("inBatch"))}</BATCH>\n                <SHIFT>${this._escapeXml(this._v("inShift"))}</SHIFT>\n                <MATERIAL>${this._escapeXml(this._v("inMaterial"))}</MATERIAL>\n                <AMOUNT>${this._escapeXml(this._v("inAmount"))}</AMOUNT>\n                <DATE>${this._escapeXml(this._v("inDate"))}</DATE>\n                <ORDEN>${this._escapeXml(this._v("inOrden"))}</ORDEN>\n                <PUESTO_TRABAJO>${this._escapeXml(this._v("inPuestoTrabajo"))}</PUESTO_TRABAJO>\n            </select>\n            </ROOT>`.trim();const t=await fetch("/api/inserthu",{method:"POST",headers:{"Content-Type":"application/xml",Accept:"application/xml"},body:e});const n=await t.text();if(!t.ok){throw new Error(`HTTP ${t.status}: ${n}`)}sap.m.MessageToast.show("Insert HU enviado correctamente");this.byId("dlgInsertHu").close()}catch(e){console.error(e);sap.m.MessageBox.error(e.message||String(e))}}})});
//# sourceMappingURL=View1.controller.js.map